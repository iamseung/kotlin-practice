name: PR Slack Notification

on:
  pull_request:
    types: [opened, reopened]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Slack notification
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          curl -X POST $SLACK_WEBHOOK_URL \
            -H 'Content-Type: application/json' \
            -d @- << EOF
          {
            "text": "새로운 Pull Request가 등록되었습니다! :rocket:",
            "blocks": [
              {
                "type": "header",
                "text": {
                  "type": "plain_text",
                  "text": "새로운 Pull Request :rocket:",
                  "emoji": true
                }
              },
              {
                "type": "section",
                "fields": [
                  {
                    "type": "mrkdwn",
                    "text": "*제목:*\n${{ github.event.pull_request.title }}"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*작성자:*\n${{ github.event.pull_request.user.login }}"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*브랜치:*\n\`${{ github.event.pull_request.head.ref }}\` → \`${{ github.event.pull_request.base.ref }}\`"
                  },
                  {
                    "type": "mrkdwn",
                    "text": "*변경 파일:*\n+${{ github.event.pull_request.additions }} / -${{ github.event.pull_request.deletions }} (${{ github.event.pull_request.changed_files }}개 파일)"
                  }
                ]
              },
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": "*설명:*\n${{ github.event.pull_request.body || '_설명 없음_' }}"
                }
              },
              {
                "type": "actions",
                "elements": [
                  {
                    "type": "button",
                    "text": {
                      "type": "plain_text",
                      "text": "PR 보기",
                      "emoji": true
                    },
                    "url": "${{ github.event.pull_request.html_url }}",
                    "style": "primary"
                  }
                ]
              }
            ]
          }
          EOF
